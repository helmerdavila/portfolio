---
title: 'C√≥mo resolver "500 session error" en Laravel Dusk'
description: Un problema entre Laravel Dusk y la versi√≥n de tu navegador
date: 2022-06-10
published: true
image: ../../src/images/blog/dusk.jpg
imageAlt: Photo by joe ting on Unsplash
---

# C√≥mo resolver 500 session error en Laravel Dusk

## ü§î ¬øC√≥mo me pas√≥?

Estaba intentando probar un framework nuevo de testing diferente a Cypress. Ya que tengo experiencia en Laravel PHP. Laravel Dusk se ve√≠a como una herramienta f√°cil de instalar. Segu√≠ las instrucciones de su sitio web pero despu√©s descubr√≠ un bug que al parecer, ocurre de vez en cuando entre los desarrolladores Laravel.

B√°sicamente, cuando la versi√≥n del navegador que usa Laravel Dusk es diferente a la versi√≥n del Sistema Operativo, es cuando el problema ocurre. Peor a√∫n, si est√°s usando Chromium en lugar de Chrome, hay una probabilidad mayor de que te ocurra seguido.

As√≠ que ac√° los pasos que segu√≠ para evitar ese error.

## üëü¬†La manera m√°s r√°pida

- Si est√°s trabajando en local. Instala Google Chrome y usa `php artisan dusk:chrome-driver <version_de_chrome>`
- Si est√°s corriendo el comando en tu servidor de testing / CI-CD, necesitas instalar Google Chrome all√≠ en lugar de usar Chromium

## üî® La soluci√≥n

Primero, ver√°s el siguiente mensaje de error.

```bash
Tests\Browser\ExampleTest::testBasicExample
Facebook\WebDriver\Exception\WebDriverCurlException: Curl error thrown for http POST to /session/d0eec334e467fffaf17d330d553bdbcc/url with params
```

Entonces, lo siguiente por hacer es:

- Tener Google Chrome instalado (√∫ltima versi√≥n o al menos una _no-tan-antigua_)
- Desinstalar otro navegador similar, como Chromium.
- Usar el comando de Laravel Dusk para instalar la versi√≥n correcta del driver

### ‚ùì Pero, qu√© pasa si estoy usando un pipeline CI/CD

Me sucedi√≥ en Github Actions. A continuaci√≥n, las l√≠neas de c√≥digo que me ayudaron a resolver el problema. Asumiendo que correr√°n sobre Ubuntu, pero podr√≠a apostar que en otro sistema operativo o servicio ser√° similar. Los pasos son: descargar el binario de Google Chrome e instalarlo.

```yaml
- name: Descargar Chrome
  run: wget -O $HOME/chrome.deb https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
- name: Instalar Chrome
  run: sudo apt install $HOME/chrome.deb
```

### ‚öôÔ∏è El comando en Laravel Dusk

Ya que instalaste Laravel Dusk, ahora podremos usar el siguiente comando:

```bash
php artisan dusk:chrome-driver <version_de_chrome>
```

¬øQu√© hace exactamente? Bueno, instalar√° el driver de Chrome para Laravel Dusk que hace posible la conexi√≥n entre las funciones del navegador y tus tests. Hay dos opciones en el comando. Puedes escribir la versi√≥n del navegador que est√°s usando, o puedes pasar la opci√≥n `‚Äî-detect`. Y Laravel tratar√° de detectar que versi√≥n de Chrome est√°s usando e instalar ese driver. Aqu√≠ una lista de ejemplos.

```bash
# Si est√°s usando Google Chrome 99, puedes instalar el driver espec√≠fico para esa versi√≥n
php artisan dusk:chrome-driver 99

# Detectar la versi√≥n de Chrome desde tu SO
php artisan dusk:chrome-driver --detect
```

Esos fueron todos los pasos que me ayudaron un par de veces a arreglar el problema. Si encuentro alguno m√°s actualizar√© el post.
